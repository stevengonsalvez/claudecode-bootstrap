# ============================================================================
# Recommended tmux configuration for agents-in-a-box
# ============================================================================
# This configuration optimizes tmux for use with Claude Code and other AI CLIs
# that generate high-frequency screen updates.
#
# Installation:
#   cp config/tmux.conf ~/.tmux.conf
#   tmux source-file ~/.tmux.conf  # reload in existing sessions
#
# Or append to existing config:
#   cat config/tmux.conf >> ~/.tmux.conf
# ============================================================================

# === History & Scrollback ===
# Large scrollback buffer for reviewing long conversations
set -g history-limit 1000000

# === Mouse Support ===
# Enable mouse for scrolling and pane selection
set -g mouse on

# === Anti-flicker Settings for Claude Code ===
# Claude Code generates 4,000-6,700 scroll events/second when updating.
# These settings help reduce (but not eliminate) visual flickering.
# See: https://github.com/anthropics/claude-code/issues/9935

# Eliminate escape sequence delay (default 500ms causes lag)
set -sg escape-time 0

# Reduce status bar refresh frequency (default 15s)
# Higher = less CPU, but stale status info
set -g status-interval 30

# Disable automatic window rename (reduces CPU overhead)
setw -g automatic-rename off

# Disable title updates (prevents some terminal flicker)
set -g set-titles off

# === Terminal Compatibility ===
# Proper terminal type for 256 colors
set -g default-terminal "tmux-256color"

# Enable RGB/true color support (tmux 3.2+)
set -as terminal-features ",*:RGB"

# === Optional: Focus Events ===
# Useful for editors that respond to focus changes
set -g focus-events on

# === Optional: Message Display ===
# How long messages are displayed (milliseconds)
set -g display-time 4000

# === Clipboard Integration (macOS) ===
# Enable OSC 52 clipboard support (works with iTerm2, Kitty, Ghostty, etc.)
set -s set-clipboard on

# Use vi keybindings in copy mode
setw -g mode-keys vi

# Copy with mouse drag release
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

# Vi-style copy bindings
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "pbcopy"

# Paste from system clipboard (prefix + P)
bind P run "pbpaste | tmux load-buffer - && tmux paste-buffer"

# === Linux Clipboard (if xclip available) ===
# Uncomment these and comment out pbcopy lines above for Linux
# bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xclip -selection clipboard"
# bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -selection clipboard"
# bind P run "xclip -selection clipboard -o | tmux load-buffer - && tmux paste-buffer"
